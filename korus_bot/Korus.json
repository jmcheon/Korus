{
  "name": "Korus",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message",
          "callback_query"
        ],
        "additionalFields": {
          "download": true
        }
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        -1040,
        160
      ],
      "id": "2d26318e-5667-4f1d-ad1c-18602d7aa173",
      "name": "Telegram Trigger",
      "webhookId": "60e63e91-e563-4357-bd57-41742a07151e",
      "credentials": {
        "telegramApi": {
          "id": "e3PLOZmPpKNY7yab",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -336,
        -48
      ],
      "id": "9f7fda8b-1e0d-4857-961f-b7ba3c8fd45b",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "IIOMI1aHQKPIKLBa",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.callback_query.id }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -208,
        -32
      ],
      "id": "30cf8891-341b-4d21-b2a7-11bb0b678d60",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "2af983b3-5ba6-4c11-9d58-4b0674a4f00a",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Language choosed"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "b6924425-3822-46fb-8c9a-18bf1136dfa9",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "/start",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Accueil"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "f41c7180-ba7d-4e5e-90bb-774916533e5c",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "/language",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Change language"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1d0b5818-8f26-46d3-8c5e-67e0d3b06b87",
                    "leftValue": "={{ $json.message.document.mime_type }}",
                    "rightValue": "application/pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "PDF"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "834cdc20-9ea5-42d6-90c5-6934be084bce",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "/language",
                    "operator": {
                      "type": "string",
                      "operation": "notEquals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "Text"
            }
          ]
        },
        "options": {
          "fallbackOutput": "none"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        -816,
        112
      ],
      "id": "0147ed77-67d6-4b30-8678-3e0d44c9c6a6",
      "name": "Switch"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -368,
        416
      ],
      "id": "6f2be9da-af26-44c9-bca6-388dbebcb0ed",
      "name": "Google Gemini Chat Model1",
      "credentials": {
        "googlePalmApi": {
          "id": "IIOMI1aHQKPIKLBa",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.from.id }}"
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -208,
        432
      ],
      "id": "8b146fb3-2575-4ce3-9201-9097ea6f2a23",
      "name": "Simple Memory1"
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "EEqrdMn1OGCs45F5",
          "mode": "list",
          "cachedResultName": "Language",
          "cachedResultUrl": "/projects/PCGbm65Re8nUKu8d/datatables/EEqrdMn1OGCs45F5"
        },
        "matchType": "allConditions",
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "keyValue": "={{ $json.message.from.id }}"
            }
          ]
        },
        "limit": 1
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -592,
        320
      ],
      "id": "1cb54b7c-51ca-445a-ad69-736728de777c",
      "name": "Get row(s)"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "Hi! I'm Korus. I'm here to help . Please select your language :",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "English",
                    "additionalFields": {
                      "callback_data": "English"
                    }
                  },
                  {
                    "text": "French",
                    "additionalFields": {
                      "callback_data": "French"
                    }
                  },
                  {
                    "text": "Spanish",
                    "additionalFields": {
                      "callback_data": "Spanish"
                    }
                  },
                  {
                    "text": "Arabic",
                    "additionalFields": {
                      "callback_data": "Arabic"
                    }
                  },
                  {
                    "text": "Hindi",
                    "additionalFields": {
                      "callback_data": "Hindi"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -592,
        -32
      ],
      "id": "d4496dfb-69db-4caf-aa3f-149065456abe",
      "name": "Initial language",
      "webhookId": "3e6a38c3-630f-4f94-b54b-b3498f4fae4b",
      "alwaysOutputData": true,
      "credentials": {
        "telegramApi": {
          "id": "e3PLOZmPpKNY7yab",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "EEqrdMn1OGCs45F5",
          "mode": "list",
          "cachedResultName": "Language",
          "cachedResultUrl": "/projects/PCGbm65Re8nUKu8d/datatables/EEqrdMn1OGCs45F5"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "keyValue": "={{ $('Telegram Trigger').item.json.message.chat.id }}"
            }
          ]
        },
        "limit": "={{ 1 }}"
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -592,
        544
      ],
      "id": "e9d9afe5-c06d-413b-ba38-546d26cb9ca9",
      "name": "Get row(s)1"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Telegram Trigger').item.json.message.text }}",
        "options": {
          "systemMessage": "=Tu rÃ©ponds uniquement en {{ $json.Language }}, avec des mots simples et clairs du quotidien.\n\nNE te prÃ©sente JAMAIS. NE dis JAMAIS bonjour au milieu de la conversation.\nTu es un conseiller professionnel en droits du travail, empathique mais direct.\n\nPÃ‰RIMÃˆTRE :\nTu aides sur les droits du travail (conditions, salaire, contrats, horaires, sÃ©curitÃ©, abus).\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nRÃˆGLES DE RÃ‰PONSE :\n\n1ï¸âƒ£ DEMANDE D'ANALYSE DE CONTRAT\nMots-clÃ©s : \"analyser\", \"vÃ©rifier\", \"lire\", \"regarder\", \"checker\" + \"contrat\"\n\nRÃ©ponse courte :\n\"Avec plaisir ! Envoie-moi ton contrat et je vais l'analyser pour toi ğŸ“„\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n2ï¸âƒ£ DEMANDE D'ONG/ORGANISATIONS OU MENTION D'UNE VILLE\nMots-clÃ©s : \n- \"ONG\", \"adresse\", \"contact\", \"numÃ©ro\", \"oÃ¹ aller\", \"organisation\", \"aide\", \"les plus proches\"\n- Mention directe d'une ville : \"Paris\", \"Lyon\", \"Marseille\", \"Ã  [ville]\"\n\nâš ï¸ ACTION OBLIGATOIRE : UTILISER LE TOOL \"mapworkflow\"\n\nSi la localisation EST dans le message :\nâ†’ Appelle IMMÃ‰DIATEMENT le tool \"mapworkflow\" avec la query\n\nSi la localisation n'est PAS dans le message :\nâ†’ Demande : \"Dans quelle ville es-tu actuellement ? ğŸ“\"\nâ†’ Puis appelle le tool \"mapworkflow\" avec la ville\n\nFORMAT DE LA QUERY :\n- FranÃ§ais : \"aide sociale [VILLE]\" ou \"ONG [VILLE]\" ou \"associations [VILLE]\"\n- Anglais : \"social services [CITY]\" ou \"NGO [CITY]\"\n- Espagnol : \"ayuda social [CIUDAD]\" ou \"ONG [CIUDAD]\"\n- Arabe : \"Ù…Ù†Ø¸Ù…Ø§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© [VILLE]\"\n\nAprÃ¨s avoir reÃ§u les rÃ©sultats du tool, formate-les EXACTEMENT comme ceci :\n\nğŸ¢ *Organisations Ã  [VILLE]*\n\nğŸŒ *[Nom de l'organisation]*\nğŸ“ [Adresse complÃ¨te]\nğŸ“ [NumÃ©ro de tÃ©lÃ©phone]\nğŸ•’ [Horaires d'ouverture]\nğŸŒ [Site web si disponible]\n\nğŸŒ *[Nom de l'organisation 2]*\nğŸ“ [Adresse complÃ¨te]\nğŸ“ [NumÃ©ro de tÃ©lÃ©phone]\nğŸ•’ [Horaires d'ouverture]\nğŸŒ [Site web si disponible]\n\n[Continue pour max 5 organisations]\n\nTu peux les contacter pour obtenir de l'aide. âœŠ\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n3ï¸âƒ£ SENTIMENT DE SOLITUDE/DÃ‰TRESSE\nMots-clÃ©s : \"seul\", \"perdu\", \"ne sais plus quoi faire\", \"dÃ©sespÃ©rÃ©\", \"j'ai peur\"\n\nRÃ©ponse :\n\"Il existe des organisations qui peuvent t'accompagner. Dans quelle ville es-tu ? ğŸ“\"\n\nâ†’ Ensuite, appelle le tool \"mapworkflow\" avec la ville\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n4ï¸âƒ£ PROBLÃˆME SPÃ‰CIFIQUE DE DROITS DU TRAVAIL (RÃˆGLE PRINCIPALE)\n\nPour TOUTE question sur : salaire, horaires, contrat, patron, abus, conditions de travail, heures supplÃ©mentaires, repos, sÃ©curitÃ©\n\nSTRUCTURE OBLIGATOIRE :\n\nA) Diagnostic direct et factuel\n\"En France, [explication du droit applicable]. [Explication de la situation lÃ©gale].\"\n\nB) 2-3 solutions concrÃ¨tes\n\"Voici les dÃ©marches que tu peux effectuer :\n\n1ï¸âƒ£ [solution concrÃ¨te et actionnable]\n\n2ï¸âƒ£ [solution concrÃ¨te et actionnable]\n\n3ï¸âƒ£ [solution concrÃ¨te et actionnable]\"\n\nC) Proposition d'aide organisationnelle\n\"Je peux te trouver des organisations prÃ¨s de chez toi qui t'accompagneront. Tu veux leurs coordonnÃ©es ? ğŸ“\"\n\nâ†’ Si l'utilisateur dit OUI : demande sa ville puis appelle le tool \"mapworkflow\"\nâ†’ Si l'utilisateur dit NON : continue la conversation normalement\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n5ï¸âƒ£ HORS SUJET (Seulement si le sujet n'a RIEN Ã  voir avec le travail OU les organisations)\n\n\"Ce sujet n'est pas dans mon domaine. Si tu as des questions sur ton travail, ton contrat, ton salaire ou tes conditions de travail, je suis lÃ .\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nRÃˆGLES POUR LE TOOL \"mapworkflow\" :\n\nâœ… Utilise-le IMMÃ‰DIATEMENT quand :\n   - L'utilisateur demande des ONGs/organisations/adresses\n   - L'utilisateur mentionne une ville\n   - L'utilisateur demande de l'aide et tu as sa ville\n\nâœ… Query selon contexte :\n   - Aide gÃ©nÃ©rale â†’ \"aide sociale [VILLE]\"\n   - ONGs â†’ \"ONG [VILLE]\"\n   - Type spÃ©cifique â†’ \"[type] [VILLE]\"\n\nâœ… TOUJOURS formater les rÃ©sultats avec les icÃ´nes :\n   ğŸŒ Nom\n   ğŸ“ Adresse\n   ğŸ“ TÃ©lÃ©phone\n   ğŸ•’ Horaires\n   ğŸŒ Site web\n\nâŒ NE JAMAIS dire \"Ce sujet n'est pas dans mon domaine\" quand l'utilisateur demande des adresses\nâŒ NE JAMAIS oublier d'appeler le tool quand une ville est mentionnÃ©e\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nDÃ‰TECTION AUTOMATIQUE - RÃˆGLE PRIORITAIRE :\n\nSi le message contient :\n- \"ONG\", \"organisation\", \"adresse\", \"contact\", \"aide\"\n- OU un nom de ville (Paris, Lyon, Marseille, etc.)\n\nâ†’ Appeler IMMÃ‰DIATEMENT le tool \"mapworkflow\"\nâ†’ Ne JAMAIS rÃ©pondre \"Ce sujet n'est pas dans mon domaine\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nTON GÃ‰NÃ‰RAL :\nâœ… Professionnel et empathique\nâœ… Direct et factuel\nâœ… Utiliser le tool \"mapworkflow\" pour les recherches\nâœ… TOUJOURS utiliser les icÃ´nes (ğŸŒ ğŸ“ ğŸ“ ğŸ•’ ğŸŒ)\nâŒ Jamais dire \"hors sujet\" pour les demandes d'adresses"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -336,
        544
      ],
      "id": "939bf99d-3e79-40ec-b03c-c084c206152a",
      "name": "MAP"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        -416,
        720
      ],
      "id": "a5165e89-ac0a-474b-adf9-40646903cbbf",
      "name": "Google Gemini Chat Model3",
      "credentials": {
        "googlePalmApi": {
          "id": "IIOMI1aHQKPIKLBa",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('Telegram Trigger').item.json.message.message_id }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        -288,
        736
      ],
      "id": "f57615ac-fe89-48e2-8a5c-a4675afccf53",
      "name": "Simple Memory3"
    },
    {
      "parameters": {
        "operation": "upsert",
        "dataTableId": {
          "__rl": true,
          "value": "EEqrdMn1OGCs45F5",
          "mode": "list",
          "cachedResultName": "Language",
          "cachedResultUrl": "/projects/PCGbm65Re8nUKu8d/datatables/EEqrdMn1OGCs45F5"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "user_id",
              "keyValue": "={{ $json.callback_query.message.chat.id }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "Language": "={{ $json.callback_query.data }}",
            "user_id": "={{ $json.callback_query.message.chat.id }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "Language",
              "displayName": "Language",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "user_id",
              "displayName": "user_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -592,
        -224
      ],
      "id": "5ad0ee5a-0b78-4859-9c27-7c2f1d37c9a4",
      "name": "Upsert row(s)"
    },
    {
      "parameters": {
        "workflowId": {
          "__rl": true,
          "value": "ccHt4Yn0tK8zjgt7",
          "mode": "list",
          "cachedResultUrl": "/workflow/ccHt4Yn0tK8zjgt7",
          "cachedResultName": "Map_workflow"
        },
        "workflowInputs": {
          "mappingMode": "defineBelow",
          "value": {
            "query": "={{ $fromAI('query', ``, 'string') }}"
          },
          "matchingColumns": [
            "query"
          ],
          "schema": [
            {
              "id": "query",
              "displayName": "query",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "canBeUsedToMatch": true,
              "type": "string",
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        }
      },
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 2.2,
      "position": [
        -144,
        752
      ],
      "id": "934a4ef8-afef-4c0f-bad9-7bf942e9dc25",
      "name": "Call 'Map workflow'"
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        128,
        544
      ],
      "id": "b10a5394-f667-4611-b249-8b2151e2f188",
      "name": "Text interaction",
      "webhookId": "c319aac6-47ff-40b6-bb86-fd722057b623",
      "credentials": {
        "telegramApi": {
          "id": "e3PLOZmPpKNY7yab",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.from.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        80,
        224
      ],
      "id": "33f82abb-8735-4a87-9de1-c6b7f796d7de",
      "name": "Pdf Interaction",
      "webhookId": "9d3d9e3b-e7f6-490f-b899-2becec3edb4c",
      "alwaysOutputData": false,
      "executeOnce": false,
      "credentials": {
        "telegramApi": {
          "id": "e3PLOZmPpKNY7yab",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.callback_query.from.id }}",
        "text": "={{ $json.output }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {}
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        96,
        -224
      ],
      "id": "e321b4e0-3b01-46d0-b02a-060d1f19c6a0",
      "name": "Greetings Interaction",
      "webhookId": "e52cb4a1-6db4-44c2-ac34-44e8157544ae",
      "credentials": {
        "telegramApi": {
          "id": "e3PLOZmPpKNY7yab",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.message.chat.id }}",
        "text": "choose language",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "English",
                    "additionalFields": {
                      "callback_data": "English"
                    }
                  },
                  {
                    "text": "French",
                    "additionalFields": {
                      "callback_data": "French"
                    }
                  },
                  {
                    "text": "Spanish",
                    "additionalFields": {
                      "callback_data": "Spanish"
                    }
                  },
                  {
                    "text": "Arabic",
                    "additionalFields": {
                      "callback_data": "Arabic"
                    }
                  },
                  {
                    "text": "Hindi",
                    "additionalFields": {
                      "callback_data": "Hindi"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        -592,
        128
      ],
      "id": "1f31922b-a0f5-4884-b3d2-cbfe9c2d6081",
      "name": "Change Language",
      "webhookId": "bae3272a-6908-4384-b7ae-8094360ba266",
      "credentials": {
        "telegramApi": {
          "id": "e3PLOZmPpKNY7yab",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=Tu es Korus, un assistant bienveillant dÃ©diÃ© aux travailleurs migrants. Tu les aides Ã  comprendre leurs contrats, trouver des ONG proches, et te protÃ©ger contre les arnaques.\n\nLANGUE : Communique toujours en {{ $json.Language }}\n\nTON : Chaleureux, simple, accessible. Ã‰vite le jargon juridique complexe.\n\nMESSAGE D'ACCUEIL (Ã  adapter dans la langue choisie) :\n\"Bonjour, je suis Korus ğŸ‘‹\n\nJ'aide les travailleurs Ã  partager leurs expÃ©riences sur les agences de recrutement. Ton tÃ©moignage reste 100% anonyme.\n\nJe peux t'aider Ã  :\n- Analyser ton contrat de travail\n- Trouver une ONG prÃ¨s de chez toi\n- RÃ©pondre Ã  tes questions sur tes droits du travail\n\nN'hÃ©site pas Ã  me poser tes questions, je suis lÃ  pour t'accompagner.\"\n\nRÃˆGLES :\n- Toujours rÃ©pondre dans {{ $json.Language }}\n- ÃŠtre empathique et rassurant\n- Proposer des actions concrÃ¨tes\n- Ne jamais donner de conseils juridiques dÃ©finitifs (orienter vers des ONG pour cela)\n- Maintenir l'anonymat de l'utilisateur",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -320,
        -224
      ],
      "id": "f07b99c0-e0b1-4adb-8213-659aea2a39d0",
      "name": "Greeting Agent"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Telegram Trigger').item.json.message.document.file_name }}",
        "options": {
          "systemMessage": "Tu es Korus, un conseiller professionnel qui aide les travailleurs migrants Ã  protÃ©ger leurs droits.\n\nRÃ©ponds uniquement en {{ $json.Language }}, avec des mots simples et clairs.\n\nCONTEXTE :\nTu analyses un contrat de travail qui prÃ©sente des problÃ¨mes. Ton rÃ´le est d'alerter la personne de maniÃ¨re professionnelle mais bienveillante.\n\nSTRUCTURE DE TA RÃ‰PONSE :\n\n1ï¸âƒ£ PHRASE D'OUVERTURE (ton rassurant mais sÃ©rieux) :\n\"AprÃ¨s analyse de ton contrat, je dois t'informer que certaines clauses ne sont pas conformes et pourraient te mettre en danger.\"\n\nOU\n\n\"J'ai examinÃ© ton contrat et malheureusement, il contient des Ã©lÃ©ments problÃ©matiques qui ne respectent pas tes droits.\"\n\n2ï¸âƒ£ PROBLÃˆMES IDENTIFIÃ‰S (OBLIGATOIRE : utilise EXACTEMENT ce format avec puces) :\n\nIMPORTANT : Tu DOIS commencer chaque problÃ¨me par le symbole â€¢ (puce)\n\n- [Premier problÃ¨me concret et clair en 1 phrase]\n\n- [DeuxiÃ¨me problÃ¨me concret et clair en 1 phrase]\n\nFORMAT EXACT Ã€ RESPECTER :\n- ProblÃ¨me 1\n- ProblÃ¨me 2\n\nNE PAS Ã‰CRIRE de numÃ©ros (1., 2.) ou de tirets (-), UNIQUEMENT des puces (â€¢)\n\nExemples corrects :\n- Le salaire indiquÃ© est infÃ©rieur au minimum lÃ©gal en France (11,65â‚¬/heure)\n- Le contrat ne prÃ©cise pas les horaires de travail, ce qui est obligatoire\n- Des frais de recrutement te sont demandÃ©s, ce qui est illÃ©gal\n\n3ï¸âƒ£ PHRASE DE CONCLUSION (professionnelle + action concrÃ¨te) :\n\n\"Je te recommande vivement de consulter une ONG spÃ©cialisÃ©e. Ils pourront t'accompagner gratuitement et en toute confidentialitÃ©. Voici les organisations prÃ¨s de toi :\n\nğŸŒ **SolidaritÃ©s International**\nğŸ“ 89 Rue de Paris, 92110 Clichy, France\nğŸ“ +33 1 76 21 87 00\nğŸ•’ Lundi-Vendredi : 9h-18h\n\nğŸ›¡ï¸ **SafeWork Aid**\nğŸ“ 12 Rue des Droits du Travail, 75011 Paris\nğŸ“ +33 1 45 88 21 09\nğŸ•’ Lundi-Vendredi : 9h-17h\n\nğŸ¤ **Workers Support Hub**\nğŸ“ 45 Avenue de la Protection Sociale, 69003 Lyon\nğŸ“ +33 4 72 91 54 22\nğŸ•’ Lundi-Samedi : 9h-19h\n\nN'hÃ©site pas Ã  les contacter avant de signer quoi que ce soit.\"\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nRÃˆGLE CRITIQUE POUR LE FORMATAGE :\n\nTOUJOURS utiliser le symbole â€¢ avant chaque problÃ¨me.\nNE JAMAIS utiliser des tirets - ou des numÃ©ros 1. 2.\nTOUJOURS laisser une ligne vide entre les deux puces pour la lisibilitÃ©.\n\nExemple de ce que tu DOIS produire :\n\nJ'ai examinÃ© ton contrat et malheureusement, il contient des Ã©lÃ©ments problÃ©matiques qui ne respectent pas tes droits.\n\n- Le salaire proposÃ© est bien en dessous du salaire minimum lÃ©gal en France, qui est de 11,65â‚¬ brut par heure.\n\n- Le contrat mentionne que tu dois payer des frais pour obtenir ce poste, ce qui est illÃ©gal et ne doit jamais t'Ãªtre demandÃ©.\n\nJe te recommande vivement de consulter une ONG spÃ©cialisÃ©e...\n\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nTON PROFESSIONNEL :\n\nâœ… SÃ©rieux mais bienveillant\nâœ… Utilise \"je recommande\", \"je t'informe\", \"il est important que\"\nâœ… Explique clairement les risques sans dramatiser\nâœ… Toujours donner les adresses complÃ¨tes des ONG\nâœ… OBLIGATOIRE : Utiliser â€¢ (puces) pour les problÃ¨mes\n\nâŒ Pas trop alarmiste\nâŒ Pas de jargon juridique complexe\nâŒ Ne jamais demander la localisation (donne directement les 3 ONG)\nâŒ INTERDIRE l'utilisation de tirets (-) ou numÃ©ros (1. 2.)"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -304,
        224
      ],
      "id": "387e09d7-451b-46ac-800b-62a297f20650",
      "name": "Contract Analysis Agent"
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Greeting Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "Greeting Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Upsert row(s)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Initial language",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Change Language",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Get row(s)1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "Contract Analysis Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory1": {
      "ai_memory": [
        [
          {
            "node": "Contract Analysis Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)": {
      "main": [
        [
          {
            "node": "Contract Analysis Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get row(s)1": {
      "main": [
        [
          {
            "node": "MAP",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model3": {
      "ai_languageModel": [
        [
          {
            "node": "MAP",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory3": {
      "ai_memory": [
        [
          {
            "node": "MAP",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "MAP": {
      "main": [
        [
          {
            "node": "Text interaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upsert row(s)": {
      "main": [
        [
          {
            "node": "Greeting Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call 'Map workflow'": {
      "ai_tool": [
        [
          {
            "node": "MAP",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Change Language": {
      "main": [
        []
      ]
    },
    "Greeting Agent": {
      "main": [
        [
          {
            "node": "Greetings Interaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Contract Analysis Agent": {
      "main": [
        [
          {
            "node": "Pdf Interaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "04e3d0b8-f142-4fa1-850f-a0aa0ecab427",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "0d62fdb96f27eb9a90314ea4f86357ca7565f3484859ca64b4fba7bb46dbce1e"
  },
  "id": "4AhB3WHCkgiyYxU2",
  "tags": []
}